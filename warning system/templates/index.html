<!DOCTYPE html>
<html>
<head>
<title>Mudslide Warning System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Minimal Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />

<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>



<link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel='stylesheet' type='text/css' />
<!-- Custom Theme files -->
<link href="{{ url_for('static', filename='css/style.css') }}" rel='stylesheet' type='text/css' />
<link href="{{ url_for('static', filename='css/font-awesome.css') }}" rel="stylesheet">

<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
<!-- Mainly scripts -->
<script src="{{ url_for('static', filename='js/jquery.metisMenu.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.slimscroll.min.js') }}"></script>
<!-- Custom and plugin javascript -->
<link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
<script src="{{ url_for('static', filename='js/custom.js') }}"></script>
<script src="{{ url_for('static', filename='js/screenfull.js') }}"></script>
<script src="{{ url_for('static', filename='js/Chart.js') }}"></script>








		<script>
		$(function () {
			$('#supported').text('Supported/allowed: ' + !!screenfull.enabled);

			if (!screenfull.enabled) {
				return false;
			}

			

			$('#toggle').click(function () {
				screenfull.toggle($('#container')[0]);
			});
			

			
		});
		</script>

<!----->

<!--pie-chart--->
<script src="{{ url_for('static', filename='js/pie-chart.js') }}" type="text/javascript"></script>

 <script type="text/javascript">

        $(document).ready(function () {
            $('#demo-pie-1').pieChart({
                barColor: '#3bb2d0',
                trackColor: '#eee',
                lineCap: 'round',
                lineWidth: 8,
                onStep: function (from, to, percent) {
                    $(this.element).find('.pie-value').text(Math.round(percent) );
                }
            });

            $('#demo-pie-2').pieChart({
                barColor: '#fbb03b',
                trackColor: '#eee',
                lineCap: 'butt',
                lineWidth: 8,
                onStep: function (from, to, percent) {
                    $(this.element).find('.pie-value').text(Math.round(percent) + '%');
                }
            });

            $('#demo-pie-3').pieChart({
                barColor: '#ed6498',
                trackColor: '#eee',
                lineCap: 'square',
                lineWidth: 8,
                onStep: function (from, to, percent) {
                    $(this.element).find('.pie-value').text(Math.round(percent) + '%');
                }
            });


        });

    </script>
<!--skycons-icons-->
<script src="{{ url_for('static', filename='js/skycons.js') }}"></script>

<!--//skycons-icons-->
</head>
<body>
<div id="wrapper">

<!----->
        <nav class="navbar-default navbar-static-top" role="navigation">
             <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <h1> <a class="navbar-brand" href="index.html">Mudslide Alert</a></h1>
			   </div>
			 <div class=" border-bottom">
        	<div class="full-left">
        	  <section class="full-top">
				<button id="toggle"><i class="fa fa-arrows-alt"></i></button>	
			</section>
			<form class=" navbar-left-right">
              <input type="text"  value="Search..." onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Search...';}">
              <input type="submit" value="" class="fa fa-search">
            </form>
            <div class="clearfix"> </div>
           </div>
     
       
            <!-- Brand and toggle get grouped for better mobile display -->
		 
		   <!-- Collect the nav links, forms, and other content for toggling -->
		    <div class="drop-men" >
		        <ul class=" nav_1">
		           
		    		<li class="dropdown at-drop">
		              <ul class="dropdown-menu menu1 " role="menu">
		                <li><a href="#">
		               
		                	<div class="user-new">
		                	<p>New user registered</p>
		                	<span>40 seconds ago</span>
		                	</div>
		                	<div class="user-new-left">
		                
		                	<i class="fa fa-user-plus"></i>
		                	</div>
		                	<div class="clearfix"> </div>
		                	</a></li>
		                <li><a href="#">
		                	<div class="user-new">
		                	<p>Someone special liked this</p>
		                	<span>3 minutes ago</span>
		                	</div>
		                	<div class="user-new-left">
		                
		                	<i class="fa fa-heart"></i>
		                	</div>
		                	<div class="clearfix"> </div>
		                </a></li>
		                <li><a href="#">
		                	<div class="user-new">
		                	<p>John cancelled the event</p>
		                	<span>4 hours ago</span>
		                	</div>
		                	<div class="user-new-left">
		                
		                	<i class="fa fa-times"></i>
		                	</div>
		                	<div class="clearfix"> </div>
		                </a></li>
		                <li><a href="#">
		                	<div class="user-new">
		                	<p>The server is status is stable</p>
		                	<span>yesterday at 08:30am</span>
		                	</div>
		                	<div class="user-new-left">
		                
		                	<i class="fa fa-info"></i>
		                	</div>
		                	<div class="clearfix"> </div>
		                </a></li>
		                <li><a href="#">
		                	<div class="user-new">
		                	<p>New comments waiting approval</p>
		                	<span>Last Week</span>
		                	</div>
		                	<div class="user-new-left">
		                
		                	<i class="fa fa-rss"></i>
		                	</div>
		                	<div class="clearfix"> </div>
		                </a></li>
		                <li><a href="#" class="view">View all messages</a></li>
		              </ul>
		            </li>
					<li class="dropdown">
		              <a href="#" class="dropdown-toggle dropdown-at"><span class=" name-caret">User</span><img src="{{ url_for('static', filename='images/wo.jpg') }}">
</a>
		            </li>
		        </ul>
		     </div><!-- /.navbar-collapse -->
			<div class="clearfix">
       
     </div>
	  
		    <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
				
                    <li>
                        <a href="index.html" class=" hvr-bounce-to-right"><i class="fa fa-dashboard nav_icon "></i><span class="nav-label">Index</span> </a>
                    </li>

                </ul>
            </div>
			</div>
             </div>
        </nav>
        <div id="page-wrapper" class="gray-bg dashbard-1">
       <div class="content-main">
 
  		<!--banner-->	
		    <div class="banner">
		   
				<h2>
							<i class="fa fa-plus"></i>
				<a href="#" data-toggle="modal" data-target="#addDataModal">Add Data</a>

					<span>  &nbsp;&nbsp;&nbsp;(&nbsp
						Input last 24 hours data to get the warining information&nbsp;)</span>
				</h2>
		    </div>
		<!--//banner-->
		<!--content-->
		<div class="content-top">
			
			
			<div class="col-md-4 ">
				<div class="content-top-1">
				<div class="col-md-6 top-content">
					<h5 class="edit1">Mud level forecast for the next hour</h5>
                    <div class="edit4">
                        <button id="edit5">Forecast</button>
                    </div>

                    <!-- 全屏加载遮罩 -->
                    <div id="loading-overlay" style="display: none;">
                        <div id="loading-message">
                            <p>Loading...</p>
                        </div>
                    </div>

                    <style>
                        /* 全屏遮罩 */
                        #loading-overlay {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-color: rgba(0, 0, 0, 0.5); /* 半透明黑色背景 */
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            z-index: 9999; /* 确保遮罩在所有内容之上 */
                        }

                        /* 加载提示文字 */
                        #loading-message {
                            color: white;
                            font-size: 24px;
                            font-weight: bold;
                        }
                    </style>







				</div>
                    <div class="col-md-6 top-content1 edit6">
                    <div id="demo-pie-111" class="edit8">
                        <span>▌ No value</span>
                    </div>

                    <div id="demo-pie-112"  class="edit7">
                        <p>▌ Nan</p>
                    </div>
                </div>




				 <div class="clearfix"> </div>
				</div>
				<div class="content-top-1">
				<div class="col-md-6 top-content">
					<h5 class="edit1">Highest mud level in the past week</h5>
					<label class="edit9"> ➤ {{ max_mud_level }}</label>
				</div>
				<div class="col-md-6 top-content1">	   
					<div id="demo-pie-2" class="pie-title-center" data-percent="60">  </div>
				</div>
				 <div class="clearfix"> </div>
				</div>
				<div class="content-top-1">
				<div class="col-md-6 top-content">
					<h5 class="edit1">Highest rainfall in the past week</h5>
					<label class="edit9"> ➤ {{ max1 }}</label>
				</div>
				<div class="col-md-6 top-content1">	   
					<div id="demo-pie-3" class="pie-title-center" data-percent="20"> </div>
				</div>
				 <div class="clearfix"> </div>
				</div>
			</div>
			<div class="col-md-8 content-top-2">
				<!---start-chart---->
				<!----->
				<div class="content-graph">
				<div class="content-color">
					<div class="content-ch"><p>X axis </p><span>Time</span>
					<div class="clearfix"> </div>
					</div>
					<div class="content-ch1"><p>Y axis</p><span> mud level</span>
					<div class="clearfix"> </div>
					</div>
				</div>
				<!--graph-->
<link rel="stylesheet" href="{{ url_for('static', filename='css/graph.css') }}">
		<!--//graph-->
<script src="{{ url_for('static', filename='js/jquery.flot.js') }}"></script>
									<script>
									$(document).ready(function () {
                                        var mud = {{ mud | tojson}};
                                        console.log();
                                        function formatTime(x) {
                                            var hours = Math.floor(x);  // Get the integer part (hours)
                                            return hours + ":00";  // Format as HH:00
                                        }
										// Graph Data ##############################################
										var graphData = [{
												// Visits
												data:
												 [ [mud[5][0], mud[5][1]],
												 [mud[4][0], mud[4][1]],
												 [mud[3][0], mud[3][1]],
												  [mud[2][0], mud[2][1]],
												 [mud[1][0], mud[1][1]],
												 [mud[0][0], mud[0][1]] ],
													color: '#FBB03B',
												points: { radius: 4, fillColor: '#FBB03B' }
											},
										];

										// Lines Graph #############################################
										$.plot($('#graph-lines'), graphData, {
											series: {
												points: {
													show: true,
													radius: 5
												},
												lines: {
													show: true
												},
												shadowSize: 0
											},
											grid: {
												color: '#7f8c8d',
												borderColor: 'transparent',
												borderWidth: 20,
												hoverable: true
											},
								        xaxis: {
                                                    tickFormatter: formatTime,  // Apply the formatTime function to the x-axis labels
                                                    axisLabel: "Time",  // Label for the x-axis
                                                    tickSize:1
                                                },
											yaxis: {
												tickSize: 0.01
											}
										});

										// Bars Graph ##############################################
										$.plot($('#graph-bars'), graphData, {
											series: {
												bars: {
													show: true,
													barWidth: .9,
													align: 'center'
												},
												shadowSize: 0
											},
											grid: {
												color: '#7f8c8d',
												borderColor: 'transparent',
												borderWidth: 20,
												hoverable: true
											},
							        xaxis: {
            tickFormatter: formatTime,  // Apply the formatTime function to the x-axis labels
            axisLabel: "Time",  // Label for the x-axis
            tickSize:1
        },
											yaxis: {
												tickSize: 1000
											}
										});

										// Graph Toggle ############################################
										$('#graph-bars').hide();

										$('#lines').on('click', function (e) {
											$('#bars').removeClass('active');
											$('#graph-bars').fadeOut();
											$(this).addClass('active');
											$('#graph-lines').fadeIn();
											e.preventDefault();
										});

										$('#bars').on('click', function (e) {
											$('#lines').removeClass('active');
											$('#graph-lines').fadeOut();
											$(this).addClass('active');
											$('#graph-bars').fadeIn().removeClass('hidden');
											e.preventDefault();
										});

										// Tooltip #################################################
										function showTooltip(x, y, contents) {
											$('<div id="tooltip">' + contents + '</div>').css({
												top: y - 16,
												left: x + 20
											}).appendTo('body').fadeIn();
										}

										var previousPoint = null;

										$('#graph-lines, #graph-bars').bind('plothover', function (event, pos, item) {
											if (item) {
												if (previousPoint != item.dataIndex) {
													previousPoint = item.dataIndex;
													$('#tooltip').remove();
													var x = item.datapoint[0],
														y = item.datapoint[1];
														showTooltip(item.pageX, item.pageY, y + ' mud level at ' + x + '.00h');
												}
											} else {
												$('#tooltip').remove();
												previousPoint = null;
											}
										});

									});
									</script>
				<div class="graph-container">
									
									<div id="graph-lines"> </div>
									<div id="graph-bars"> </div>
								</div>
	
		</div>
		</div>
		<div class="clearfix"> </div>
		</div>
		<!---->
	


		<div class="graph-grid">

			<div class="col-md-6 edit2">
				<div class="weather">
					<div class="weather-top">
						<div class="weather-top-left">
							<div class="degree">
							<figure class="icons">
								<canvas id="partly-cloudy-day" width="64" height="64">
								</canvas>
							</figure>
							<span>{{ temperature }}°</span>
							<div class="clearfix"></div>
							</div>
				<script>
							 var icons = new Skycons({"color": "#1ABC9C"}),
								  list  = [
									"clear-night", "partly-cloudy-day",
									"partly-cloudy-night", "cloudy", "rain", "sleet", "snow", "wind",
									"fog"
								  ],
								  i;

							  for(i = list.length; i--; )
								icons.set(list[i], list[i]);

							  icons.play();
						</script>
							<p>Report time: {{ reporttime }}

							</p>
						</div>
						<div class="weather-top-right">
							<p>SeWei - XinLong - Sichuan</p>
						</div>
						<div class="clearfix"> </div>
					</div>
					<div class="weather-bottom">
			<div class="weather-bottom1">
				<div class="weather-head">
				<h4>Weather</h4>
				<figure class="icons">
					<canvas id="cloudy" width="58" height="58"></canvas>
				</figure>
					<script>
							 var icons = new Skycons({"color": "#999"}),
								  list  = [
									"clear-night", "cloudy",
									"partly-cloudy-night", "cloudy", "rain", "sleet", "snow", "wind",
									"fog"
								  ],
								  i;

							  for(i = list.length; i--; )
								icons.set(list[i], list[i]);

							  icons.play();
						</script>
				<h6>{{ weather_ }}</h6>

			</div>

			</div>
			<div class="weather-bottom1 ">
				<div class="weather-head">
			<h4>Temperatyre</h4>
			<figure class="icons">
				<canvas id="clear-day" width="58" height="58">
				</canvas>
			</figure>
					<script>
							 var icons = new Skycons({"color": "#999"}),
								  list  = [
									"clear-night", "clear-day",
									"partly-cloudy-night", "cloudy", "rain", "sleet", "snow", "wind",
									"fog"
								  ],
								  i;

							  for(i = list.length; i--; )
								icons.set(list[i], list[i]);

							  icons.play();
						</script>
			<h6>{{ temperature}}°C</h6>

			</div>
			</div>
			<div class="weather-bottom1">
				<div class="weather-head">
				<h4>Humidity</h4>
				<figure class="icons">
					<canvas id="sleet" width="58" height="58">
					</canvas>
				</figure>
				<script>
							 var icons = new Skycons({"color": "#999"}),
								  list  = [
									"clear-night", "clear-day",
									"partly-cloudy-night", "cloudy", "rain", "sleet", "snow", "wind",
									"fog"
								  ],
								  i;

							  for(i = list.length; i--; )
								icons.set(list[i], list[i]);

							  icons.play();
						</script>

				<h6>{{ humidity}}%</h6>

			</div>
			</div>
			<div class="weather-bottom1 ">
				<div class="weather-head">
			<h4>wind</h4>
			<figure class="icons">
					<canvas id="wind" width="58" height="58">
					</canvas>
				</figure>
				<script>
							 var icons = new Skycons({"color": "#999"}),
								  list  = [
									"clear-night", "clear-day",
									"partly-cloudy-night", "cloudy", "rain", "sleet", "snow", "wind",
									"fog"
								  ],
								  i;

							  for(i = list.length; i--; )
								icons.set(list[i], list[i]);

							  icons.play();
						</script>
			<h6>{{ windpower }}</h6>
			<div class="bottom-head" style="color: white">
					<p>1 </p >
					<p> 1</p>
				</div>
				</div>
			</div>
			<div class="clearfix"> </div>
		</div>


				</div>
			</div>
			<div class="col-md-6 graph-1">
		<div class="grid-1">
									<h4>Rainfall</h4>
									<canvas id="bar1" height="313" width="700" style="width: 400px; height: 300px;"></canvas>
									<script>

										var barChartData = {
											labels : ["{{ date_rain[9][0] }}", "{{ date_rain[8][0] }}","{{ date_rain[7][0] }}","{{ date_rain[6][0] }}",
											"{{ date_rain[5][0] }}","{{ date_rain[4][0] }}","{{ date_rain[3][0] }}","{{ date_rain[2][0] }}",
											"{{ date_rain[1][0] }}","{{ date_rain[0][0] }}"],
											datasets : [
												{
													fillColor : "#FBB03B",
													strokeColor : "#FBB03B",
													data : ["{{ date_rain[9][1] }}", "{{ date_rain[8][1] }}","{{ date_rain[7][1] }}","{{ date_rain[6][1] }}",
											"{{ date_rain[5][1] }}","{{ date_rain[4][1] }}","{{ date_rain[3][1] }}","{{ date_rain[2][1] }}",
											"{{ date_rain[1][1] }}","{{ date_rain[0][1] }}"]
												},

											]

										};

new Chart(document.getElementById("bar1").getContext("2d")).Bar(barChartData, {
        scaleOverride: true,  // 使得我们能够覆盖默认的刻度设置
        scaleStartValue: 0,  // y 轴从 0 开始
        scaleStepWidth: 0.05,  // 每个刻度之间的间隔为 0.05
        scaleSteps: 10,  // 总共显示的刻度数目
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true  // y 轴从 0 开始
                }
            }]
        }
    });

									</script>
								</div>
	</div>
			<div class="clearfix"> </div>
						<div class="clearfix"> </div>
		</div>
		<!--//content-->



<script>
    document.getElementById("edit5").addEventListener("click", function() {
        // 显示全屏加载遮罩
        document.getElementById("loading-overlay").style.display = "flex";

        // 获取数据并发送到后端进行预测
        fetch('/predict', {
            method: 'GET',  // 或者 'POST'，取决于您的 Flask 路由
        })
        .then(response => response.json())  // 假设返回的是 JSON 格式的预测结果
        .then(data => {
            // 隐藏全屏加载遮罩
            document.getElementById("loading-overlay").style.display = "none";

            // 获取预测值，并确保它是数字类型
            var percentValue = parseFloat(data.prediction).toFixed(3);  // 确保是数字并保留三位小数
            var pieValueElement = document.getElementById("demo-pie-111").querySelector("span");
            var value1 = document.getElementById("demo-pie-112").querySelector("p");

            // 更新 <span> 中的文本内容
            pieValueElement.textContent ="▌ " + percentValue  + "m";  // 显示预测结果作为百分比

            // 根据百分比值添加不同的文本信息
            if (percentValue > 0.8) {
                value1.textContent = "Alert";  // 大于0.8，显示 "Alert"

            } else if (percentValue > 0.6) {
                value1.textContent = "Need attention";  // 大于0.6，显示 "Need attention"
            } else {
                value1.textContent = "▌ Safe";
            }
        })
        .catch((error) => {
            // 隐藏全屏加载遮罩
            document.getElementById("loading-overlay").style.display = "none";
            console.error('Error:', error);
        });
    });
</script>






<!-- Modal -->
<div class="modal fade" id="addDataModal" tabindex="-1" role="dialog" aria-labelledby="addDataModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addDataModalLabel">Add Data</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top: -20px;">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Date Picker -->
        <div class="form-group">
          <label for="dataDate">Date and Time</label>
          <input type="datetime-local" class="form-control" id="dataDate" required>
        </div>

        <!-- Mud Data Input -->
        <div class="form-group">
          <label for="dataMudLevel">Mud Level</label>
          <input type="text" class="form-control" id="dataMudLevel" placeholder="Enter mud level" required>
        </div>

        <!-- Site Selection -->
        <div class="form-group">
          <label for="dataSite">Site</label>
          <select class="form-control" id="dataSite" required>
            {% for site in sites %}
              <option value="{{ site.id }}">{{ site.site }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="uploadDataBtn" style="border-radius: 12px;">Upload Data</button>
      </div>
    </div>
  </div>
</div>


<script>
    $(document).ready(function() {
  $('#uploadDataBtn').on('click', function() {
    // Capture the values from the input fields
    var dataDate = $('#dataDate').val();
    var dataMudLevel = $('#dataMudLevel').val();
    var dataSite = $('#dataSite').val();

    // Ensure all fields are filled
    if (!dataDate || !dataMudLevel || !dataSite) {
      alert("Please fill all fields.");
      return;
    }

    // Prepare the data to send
    var data = {
      time: dataDate,
      mud_level: parseFloat(dataMudLevel),
      site_id: parseInt(dataSite)
    };

    // Send data to Flask backend using AJAX
    $.ajax({
      url: '/add_data',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(data),
      success: function(response) {
        // If success, close the modal and clear the form
        alert('Data added successfully!');
        $('#addDataModal').modal('hide');
        $('#dataDate').val('');
        $('#dataMudLevel').val('');
        $('#dataSite').val('');
      },
      error: function(error) {
        alert('Error adding data.');
        console.log(error);
      }
    });
  });
});

</script>







		<!---->
<div class="copy">
	    </div>
		</div>
		<div class="clearfix"> </div>
       </div>
     </div>
<!---->
<!--scrolling js-->
<script src="{{ url_for('static', filename='js/jquery.nicescroll.js') }}"></script>
{#<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>#}
<!--//scrolling js-->
<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"> </script>

</body>
</html>

